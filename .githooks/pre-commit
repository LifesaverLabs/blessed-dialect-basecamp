#!/bin/sh
#
# Pre-commit hook to validate code quality before commits
# Ensures: dictionary validation, tests pass, and app builds successfully
#

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "${BLUE}========================================${NC}"
echo "${BLUE}Pre-commit Quality Checks${NC}"
echo "${BLUE}========================================${NC}"
echo ""

# Track overall status
FAILED=0

# 1. Dictionary Validation
echo "${YELLOW}[1/3] Running dictionary validation...${NC}"
if node scripts/validate-dictionary.js; then
  echo "${GREEN}✅ Dictionary validation passed${NC}"
  echo ""
else
  echo "${RED}❌ Dictionary validation failed${NC}"
  echo "${YELLOW}Fix errors with: npm run validate-dict${NC}"
  echo ""
  FAILED=1
fi

# 2. Run Tests
echo "${YELLOW}[2/3] Running test suite...${NC}"
if npm run test; then
  echo "${GREEN}✅ All tests passed${NC}"
  echo ""
else
  echo "${RED}❌ Tests failed${NC}"
  echo "${YELLOW}Fix errors with: npm run test${NC}"
  echo ""
  FAILED=1
fi

# 3. Build Validation
echo "${YELLOW}[3/3] Validating build...${NC}"
if npm run build > /dev/null 2>&1; then
  echo "${GREEN}✅ Build successful${NC}"
  echo ""
else
  echo "${RED}❌ Build failed${NC}"
  echo "${YELLOW}Fix errors with: npm run build${NC}"
  echo ""
  FAILED=1
fi

# Final result
echo "${BLUE}========================================${NC}"
if [ $FAILED -eq 0 ]; then
  echo "${GREEN}✅ All pre-commit checks passed!${NC}"
  echo "${BLUE}========================================${NC}"
  exit 0
else
  echo "${RED}❌ Pre-commit checks failed${NC}"
  echo "${YELLOW}Please fix the errors above before committing${NC}"
  echo "${YELLOW}To bypass (not recommended): git commit --no-verify${NC}"
  echo "${BLUE}========================================${NC}"
  exit 1
fi
